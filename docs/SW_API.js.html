<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>SW_API.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="SW_API.html">SW_API</a><ul class='methods'><li data-type='method'><a href="SW_API.html#.getAllResourcesByType">getAllResourcesByType</a></li><li data-type='method'><a href="SW_API.html#.getResourceById">getResourceById</a></li><li data-type='method'><a href="SW_API.html#.getResourcesBySearch">getResourcesBySearch</a></li><li data-type='method'><a href="SW_API.html#.getResourceTypes">getResourceTypes</a></li></ul></li></ul>
</nav>

<div id="main">
    
    <h1 class="page-title">SW_API.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/*
 * SWAPI_nodeWrapper was written by Scott Mollon and released under an MIT license. It is a nodejs interface for SWAPI (Star Wars API).
 * 
 * @license
 * The MIT License (MIT)
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), 
 * to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */

var SW_API = function() {
    
    var request = require('request');
    var q = require('q');
    
    var BASEURL = 'http://swapi.co/api/';   //Base url for the API
    
    // A list of the API resources which is downloaded from the API itself.
    // This list includes what resources are supported and URI for each
    var allResourceList = null;
    
    /**
     * @method SW_API.send_request
     * @private
     * @description Handles sending the GET requests to the api
     * @param url - The url to which to send the request
     * @param data - The query parameters for the request
     * @param callback - The callback function for the request is resolved
     */
    var send_request = function(url, data, callback){
        
        data = data || {};

        var options = {
            url: url,
            method: 'GET',
            qs: data
        };
        
        request(options, callback);
    };
    
    /**
    * @method SW_API.getAllResources
    * @private
    * @description Gets the supported resources from the API
    */
    var getAllResources = function() {
        var deferred = q.defer();

        var callback = function(error, response, body){
            if (error){
                deferred.reject(error);
            }
            else if (response.statusCode === 200) {
                
                //save resource info privately
                allResourceList = JSON.parse(body);
                
                deferred.resolve(true);
            }
            else {
                deferred.reject(body.message);
            }
        };

        send_request(BASEURL, {}, callback);

        return deferred.promise;
    };
    
    /**
    * @method SW_API.checkAllResources
    * @private
    * @description Checks to see if the resource information has been downloaded from 
    * the API, and if not downloads it.
    */
    var checkAllResources = function() {
        var deferred = q.defer();

        if (allResourceList === null)
            getAllResources().then(function(){
                deferred.resolve(true);
            }, function(error){
                deferred.reject(error);
            });
        else
          deferred.resolve(true);

        return deferred.promise;
    };
    
    /**
     * SW_API
     * @class SW_API
     * @version 1.0.0
     * @description A javascript node js interface for the SWAPI (Star Wars API).
     */
    return {
        /**
         * @method SW_API.getResourceTypes
         * @description Returns a string array of the supported resources such as people, vehicles, planets, etc...
         * @returns {'string[]'} A promise which will resolve to a string array
         */
        getResourceTypes: function() {
            var deferred = q.defer();
            
            checkAllResources().then(function(){
                deferred.resolve(Object.keys(allResourceList));
            });
 
            return deferred.promise;
        },
        /**
         * @method SW_API.getAllResourcesByType
         * @description Returns a paged list of all items of a specific resource type. The resource type must be one
         * of the types the API supports. If no page is provided when called the first page of results is returned.
         * @param {string} resource - The type of resource for which to retrieve items such as people, planets, vehicles.
         * @param {int} page - The page of results to retrieve.
         * @returns {json} - A promise which will resolve a json response with a results list and information about number of and current page.
         * @example //Get first page of results
         * var SWAPI = require('SW_API');
         * SWAPI.getAllResourcesByType('people').then(function(pagedResult){
         *   //do something with pagedResults of people
         * });
         * @example //Request a page of results
         * var SWAPI = require('SW_API');
         * SWAPI.getAllResourcesByType('people', 2).then(function(pagedResult){
         *   //do something with pagedResults of people
         * });
         * @example //Response
         * {
         *  'totalPages': 3,
         *  'currentPage': 2,
         *  'count': 26,
         *  'next': 'http://...../?page=3',
         *  'previous': 'http://...../?page=1',
         *  'results': []
         * }
         */
        getAllResourcesByType: function(resource, page) {
            var deferred = q.defer();
            
            page = page || 1;
            
            var pagedCallback = function(error, response, body){
                if (error){
                    deferred.reject(error);
                }
                else if (response.statusCode === 200) {
                    responseBody = JSON.parse(body);
                    responseBody.totalPages = Math.ceil(responseBody.count / 10);
                    responseBody.currentPage = page;
                    deferred.resolve(responseBody);
                }
                else
                {
                    deferred.reject(JSON.parse(body));
                }
            };
            
            checkAllResources().then(function(){
                send_request(allResourceList[resource], {'page': page}, pagedCallback);
            });
 
            return deferred.promise;
        },
        /**
         * @method SW_API.getResourceById
         * @description Returns a single item of a given resource type found by it's id.
         *  @param {string} resource - The type of resource for which to retrieve the item such as people, planets, vehicles.
         *  @param {int} id - The id of the specific item
         *  @returns {json} - A promise which will resolve to the json object describing the item
         *  @example //Retrieve a vehicle by id of 10
         *  var SWAPI = require('SW_API');
         *  SWAPI.getResourceById('vehicle', 10).then(function(vehicle){
         *   //do something with vehicle
         * });
         */
        getResourceById: function(resource, id) {
            var deferred = q.defer();
            
            var callback = function(error, response, body){
                if (error){
                    deferred.reject(error);
                }
                else if (response.statusCode === 200) {
                    deferred.resolve(JSON.parse(body));
                }
                else {
                    deferred.reject(body.message);
                }
            };
            
            checkAllResources().then(function(){
                send_request(allResourceList[resource]+id, {}, callback);
            });
 
            return deferred.promise;
        },
        /**
         * @method SW_API.getResourcesBySearch
         * @description Returns a paged list of all items of a specific resource type matching a search string. The resource type must be one
         * of the types the API supports. If no page is provided when called the first page of results is returned.
         * @param {string} resource - the type of resource for which to retrieve items such as people, planets, vehicles.
         * @param {string} searchString - The value to use when searching items.
         * @param {int} page - The page of results to retrieve.
         * @returns {json} - A promise which will resolve a json response with a results list and information about number of and current page.
         * @example //Get first page of results
         * var SWAPI = require('SW_API');
         * SWAPI.getResourcesBySearch('people', 'Fett').then(function(pagedResult){
         *   //do something with pagedResults of people matchign Fett
         * });
         * @example //Request a page of results
         * var SWAPI = require('SW_API');
         * SWAPI.getAllResourcesByType('people', 'Fett', 2).then(function(pagedResult){
         *   //do something with pagedResults of people matchign Fett
         * });
         * @example //Response
         * {
         *  'totalPages': 3,
         *  'currentPage': 2,
         *  'count': 26,
         *  'next': 'http://...../?search=Fett&amp;page=3',
         *  'previous': 'http://...../?search=Fett&amp;page=1',
         *  'results': []
         * }
         */
        getResourcesBySearch: function(resource, searchString, page) {
            var deferred = q.defer();
            
            page = page || 1;
            
            var pagedCallback = function(error, response, body){
                if (error){
                    deferred.reject(error);
                }
                else if (response.statusCode === 200) {
                    responseBody = JSON.parse(body);
                    responseBody.totalPages = Math.ceil(responseBody.count / 10);
                    responseBody.currentPage = page;
                    deferred.resolve(responseBody);
                }
                else
                {
                    deferred.reject(JSON.parse(body));
                }
            };
            
            checkAllResources().then(function(){
                send_request(allResourceList[resource], {'search': searchString, 'page': page}, pagedCallback);
            });
 
            return deferred.promise;
        }
    };
};

module.exports = new SW_API();</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Wed Nov 16 2016 10:56:48 GMT-0500 (Eastern Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
