/*
 * SWAPI_nodeWrapper was written by Scott Mollon and released under an MIT license. It is a nodejs interface for SWAPI (Star Wars API).
 * 
 * @license
 * The MIT License (MIT)
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), 
 * to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, 
 * and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, 
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
 * WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 */
var SW_API=function(){var a=require("request"),b=require("q"),c="http://swapi.co/api/",d=null,e=function(b,c,d){c=c||{};var e={url:b,method:"GET",qs:c};a(e,d)},f=function(){var a=b.defer(),f=function(b,c,e){b?a.reject(b):200===c.statusCode?(d=JSON.parse(e),a.resolve(!0)):a.reject(e.message)};return e(c,{},f),a.promise},g=function(){var a=b.defer();return null===d?f().then(function(){a.resolve(!0)},function(b){a.reject(b)}):a.resolve(!0),a.promise};return{getResourceTypes:function(){var a=b.defer();return g().then(function(){a.resolve(Object.keys(d))}),a.promise},getAllResourcesByType:function(a,c){var f=b.defer();c=c||1;var h=function(a,b,d){a?f.reject(a):200===b.statusCode?(responseBody=JSON.parse(d),responseBody.totalPages=Math.ceil(responseBody.count/10),responseBody.currentPage=c,f.resolve(responseBody)):f.reject(JSON.parse(d))};return g().then(function(){e(d[a],{page:c},h)}),f.promise},getResourceById:function(a,c){var f=b.defer(),h=function(a,b,c){a?f.reject(a):200===b.statusCode?f.resolve(JSON.parse(c)):f.reject(c.message)};return g().then(function(){e(d[a]+c,{},h)}),f.promise},getResourcesBySearch:function(a,c,f){var h=b.defer();f=f||1;var i=function(a,b,c){a?h.reject(a):200===b.statusCode?(responseBody=JSON.parse(c),responseBody.totalPages=Math.ceil(responseBody.count/10),responseBody.currentPage=f,h.resolve(responseBody)):h.reject(JSON.parse(c))};return g().then(function(){e(d[a],{search:c,page:f},i)}),h.promise}}};module.exports=new SW_API;